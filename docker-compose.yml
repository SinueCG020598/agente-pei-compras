version: '3.8'

services:
  # Evolution API para WhatsApp
  evolution-api:
    image: atendai/evolution-api:latest
    container_name: pei-evolution-api
    ports:
      - "8080:8080"
    environment:
      - AUTHENTICATION_API_KEY=e25391171441103e98ada7e0db73744f454d935b3ce70fd8ffe7a240b23f8088
      - DATABASE_ENABLED=true
      - DATABASE_CONNECTION_URI=mongodb://mongo:27017/evolution
      - DATABASE_CONNECTION_DB_PREFIX_NAME=evolution
    volumes:
      - evolution_instances:/evolution/instances
      - evolution_store:/evolution/store
    networks:
      - pei-network
    depends_on:
      - mongo
    restart: unless-stopped

  # MongoDB para Evolution API
  mongo:
    image: mongo:latest
    container_name: pei-mongo
    ports:
      - "27017:27017"
    environment:
      - MONGO_INITDB_ROOT_USERNAME=root
      - MONGO_INITDB_ROOT_PASSWORD=rootpassword
    volumes:
      - mongo_data:/data/db
    networks:
      - pei-network
    restart: unless-stopped

  # PostgreSQL (para migraci√≥n futura desde SQLite)
  # postgres:
  #   image: postgres:15
  #   container_name: pei-postgres
  #   ports:
  #     - "5432:5432"
  #   environment:
  #     - POSTGRES_DB=pei_compras
  #     - POSTGRES_USER=pei_user
  #     - POSTGRES_PASSWORD=pei_password
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data
  #   networks:
  #     - pei-network
  #   restart: unless-stopped

volumes:
  evolution_instances:
  evolution_store:
  mongo_data:
  # postgres_data:

networks:
  pei-network:
    driver: bridge
